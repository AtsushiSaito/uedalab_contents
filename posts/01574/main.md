<h1 style="font-size: 250%;">ロボットシステム学</h1>-c-c-c-<h2>第3回</h2>-c-c-c-上田 隆一-c-c-c--c-c-c-2016年9月?日\@千葉工業大学-c-c-c--c-c-c-<!--nextpage-->-c-c-c-<h2>今日の内容</h2>-c-c-c-<ul>-c-c-c- 	<li>マイコンの仕組み-c-c-c-<ul>-c-c-c- 	<li>本講義はOSの存在を前提としているので仕組みだけ簡単に</li>-c-c-c- 	<li>OSの説明のために知識だけ簡潔に</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>OSの役割、仕組み</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<h2>マイコン</h2>-c-c-c-<ul>-c-c-c- 	<li>この２つのモノの略語-c-c-c-<ul>-c-c-c- 	<li>マイクロコンピュータ-c-c-c-<ul>-c-c-c- 	<li>今で言うPC</li>-c-c-c- 	<li><a href="https://ja.wikipedia.org/wiki/%E3%82%B3%E3%83%A2%E3%83%89%E3%83%BC%E3%83%AB64" target="_blank">例（コモドール64）</a></li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li><span style="color: #ffff00;">マイクロコントローラ</span>-c-c-c-<ul>-c-c-c- 	<li>ピンから様々な入出力ができるようになっているIC</li>-c-c-c- 	<li><a href="https://ja.wikipedia.org/wiki/Atmel_AVR" target="_blank">例（Atmel AVR）</a></li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<h2>マイクロコントローラ</h2>-c-c-c-<ul>-c-c-c- 	<li>何のために使うか-c-c-c-<ul>-c-c-c- 	<li>（おそらく私より皆さんの方が詳しいでしょう）</li>-c-c-c- 	<li>デジタル回路に組み込んで使って機器を動かす-c-c-c-<ul>-c-c-c- 	<li>いくつかのピンから電気信号を入力</li>-c-c-c- 	<li>しかるべき電気信号を出力</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<h2>マイコンが無いと・・・</h2>-c-c-c-<ul>-c-c-c- 	<li>回路の部分が増える、回路が増えると・・・-c-c-c-<ul>-c-c-c- 	<li>変更できない、基板の面積をとる、故障したら自分で直さなければならない、電圧・電流の計算面倒くさい、・・・</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>計算の回路は本質的にややこしい-c-c-c-<ul>-c-c-c- 	<li>例: リレー式計算機-c-c-c-<iframe src="https://www.youtube.com/embed/WtzpbZUF2eg" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>ソフトウェアで入出力の関係を実装できるのがマイコンの有り難み</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<h2>とても簡単な例</h2>-c-c-c-<ul>-c-c-c- 	<li>簡単なLチカ回路-c-c-c-<ul>-c-c-c- 	<li>同じ回路で・・・-c-c-c-<ul>-c-c-c- 	<li>スイッチのON/OFFとLEDのON/OFFの関係を変更可能</li>-c-c-c- 	<li>LEDの明るさ等を変更可能</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<a href="https://lab.ueda.asia/wp-content/uploads/2016/09/circuit-photo.jpg"><img class="size-medium wp-image-1487 alignnone" src="https://lab.ueda.asia/wp-content/uploads/2016/09/circuit-photo-295x300.jpg" alt="circuit-photo" width="295" height="300" />　</a><a href="https://lab.ueda.asia/wp-content/uploads/2016/09/circuit.jpg"><img class="size-medium wp-image-1486 alignnone" src="https://lab.ueda.asia/wp-content/uploads/2016/09/circuit-300x201.jpg" alt="circuit" width="300" height="201" /></a>  <a href="https://lab.ueda.asia/wp-content/uploads/2016/09/code.jpg"><img class="alignnone size-medium wp-image-1491" src="https://lab.ueda.asia/wp-content/uploads/2016/09/code-300x204.jpg" alt="code" width="300" height="204" /></a>-c-c-c--c-c-c-<!--nextpage-->-c-c-c-<h2>マイコンの中身</h2>-c-c-c-どうなっているのか？-c-c-c-<ul>-c-c-c- 	<li>大雑把に言って以下の3要素で構成される-c-c-c-<ul>-c-c-c- 	<li>メモリ</li>-c-c-c- 	<li>MPU（micro processing unit）</li>-c-c-c- 	<li>I/O（I/Oポート）</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>3要素がバスでつながっている-c-c-c-<ul>-c-c-c- 	<li>例: <a href="http://www.atmel.com/ja/jp/devices/ATMEGA328P.aspx" target="_blank">ATmega328P</a>（Summaryの8ページ）</li>-c-c-c- 	<li><a href="https://avr.jp/user/Clog.htm#X3-28" target="_blank">日本語のデータシート</a></li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<h2>メモリ</h2>-c-c-c-<ul>-c-c-c- 	<li>データやプログラムを置く</li>-c-c-c- 	<li>以下の3種が適所に配置されている</li>-c-c-c-</ul>-c-c-c-<table style="border: 1px solid #FFF;" width="687">-c-c-c-<tbody>-c-c-c-<tr>-c-c-c-<td style="border: 1px solid #FFF;" width="160"></td>-c-c-c-<td style="border: 1px solid #FFF;" width="193">用途</td>-c-c-c-<td style="border: 1px solid #FFF;" width="147">電源OFF後-c-c-c--c-c-c-のデータ</td>-c-c-c-<td width="200">動作の速さ</td>-c-c-c-</tr>-c-c-c-<tr>-c-c-c-<td style="border: 1px solid #FFF;" width="200">フラッシュメモリ</td>-c-c-c-<td style="border: 1px solid #FFF;" width="193">プログラム</td>-c-c-c-<td style="border: 1px solid #FFF;" width="147">残る</td>-c-c-c-<td style="border: 1px solid #FFF;" width="188">遅い</td>-c-c-c-</tr>-c-c-c-<tr>-c-c-c-<td style="border: 1px solid #FFF;" width="160">EEPROM</td>-c-c-c-<td style="border: 1px solid #FFF;" width="193">保存用データ</td>-c-c-c-<td style="border: 1px solid #FFF;" width="147">残る</td>-c-c-c-<td style="border: 1px solid #FFF;" width="188">遅い</td>-c-c-c-</tr>-c-c-c-<tr>-c-c-c-<td style="border: 1px solid #FFF;" width="160">SRAM</td>-c-c-c-<td style="border: 1px solid #FFF;" width="193">計算中のデータ等</td>-c-c-c-<td style="border: 1px solid #FFF;" width="147">消える</td>-c-c-c-<td style="border: 1px solid #FFF;" width="188">速い</td>-c-c-c-</tr>-c-c-c-</tbody>-c-c-c-</table>-c-c-c-<h2><!--nextpage--></h2>-c-c-c-<h2>メモリのアドレス</h2>-c-c-c-<ul>-c-c-c- 	<li>C言語に出てくるポインタでおなじみ</li>-c-c-c- 	<li>アドレス: 住所</li>-c-c-c- 	<li>アドレス空間: n個のメモリセルごとに住所をつけたもの-c-c-c-<ul>-c-c-c- 	<li>1個のメモリセルは0か1の1ビット情報を保持</li>-c-c-c- 	<li>8ビットなら8個のメモリセルに一つ住所を与える</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>住所のつけ方-c-c-c-<ul>-c-c-c- 	<li>ひたすら無骨に0番からN番まで数字で</li>-c-c-c- 	<li>プログラムで操作するときは16進数になることが多いが、それはあんまり本質的ではない</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<h2><!--nextpage--></h2>-c-c-c-<h2>MPUでの処理の流れ</h2>-c-c-c-<ul>-c-c-c- 	<li>これの繰り返し-c-c-c-<ol>-c-c-c- 	<li>命令をメモリから取得-c-c-c-<ul>-c-c-c- 	<li>命令: アセンブリ言語の1行に相当-c-c-c-<ul>-c-c-c- 	<li><span style="color: #00ffff;">「1番と5番のメモリの中身を足して4番に保存」等</span></li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>命令に従ってMPUがメモリの中身を操作</li>-c-c-c-</ol>-c-c-c-</li>-c-c-c- 	<li> 参考-c-c-c-<ul>-c-c-c- 	<li>坂井 弘亮 (著): 熱血!アセンブラ入門,秀和システム, 2014.-c-c-c-<ul>-c-c-c- 	<li>実例豊富。様々なCPU</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-&nbsp;-c-c-c--c-c-c-<!--nextpage-->-c-c-c-<h2>I/Oはどう操作する？</h2>-c-c-c-<ul>-c-c-c- 	<li>メモリの中だけいじっていてもピンに信号は出せない</li>-c-c-c- 	<li>MPUとピンの間には<span style="color: #ffff00;">「I/Oポート」</span>が存在-c-c-c-<ul>-c-c-c- 	<li>I/Oポートにバイナリを書き込むとピンの入出力・挙動が変化</li>-c-c-c- 	<li>一番単純（安直）な例-c-c-c-<ul>-c-c-c- 	<li>二進数で8ビットのデータ10101010をポートに書き込むと-c-c-c-ピンがHI LOW HI LOW HI LOW HI LOW と出力</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>他に入出力の切り替え等があるので実際はもっと複雑</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<h2><!--nextpage--></h2>-c-c-c-<h2>MPUからI/Oポートへのアクセス</h2>-c-c-c-<ul>-c-c-c- 	<li><span style="color: #ffff00;">メモリマップドI/O</span>-c-c-c-<ul>-c-c-c- 	<li>メモリのアドレス空間にポートのアドレスがマッピングされている</li>-c-c-c- 	<li>メモリの読み書きもポートの読み書きも同じ命令を使う</li>-c-c-c- 	<li>例-c-c-c-<ul>-c-c-c- 	<li>10番のアドレス（メモリに割り当て）に100を書く-c-c-c--&gt;メモリに100が書き込まれる</li>-c-c-c- 	<li>2番のアドレス（ポートに割り当て）に100を書く-c-c-c--&gt;ポートに100が渡って解釈され、ピンの状態が変わる</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>抽象度が高い</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>ポートマップドI/O（I/OマップドI/O）-c-c-c-<ul>-c-c-c- 	<li>メモリとI/Oポートのアドレス空間が別</li>-c-c-c- 	<li>抽象度が低い</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<h2>ここまでのまとめ</h2>-c-c-c-<ul>-c-c-c- 	<li>マイコンはMPUとメモリ、I/Oから構成される</li>-c-c-c- 	<li>メモリマップドI/OのMPUはメモリやI/Oを同じアドレス空間で操作-c-c-c-<ul>-c-c-c- 	<li><span style="color: #ffff00;">抽象化</span></li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<h2>補足: 安価なマイコンの構造</h2>-c-c-c-<ul>-c-c-c- 	<li><a href="https://ja.wikipedia.org/wiki/%E3%83%8F%E3%83%BC%E3%83%90%E3%83%BC%E3%83%89%E3%83%BB%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3" target="_blank">ハーバードアーキテクチャ</a>-c-c-c-<ul>-c-c-c- 	<li>命令を保存するメモリとデータ用のメモリが別-c-c-c-<ul>-c-c-c- 	<li>プログラムを途中で書き換えないならこれで良い-c-c-c-<ul>-c-c-c- 	<li>書き換えさせたくないという考えもある</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>プログラムとデータが混在するノイマン型とは違う</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<img src="https://lab.ueda.asia/wp-content/uploads/2016/09/harvard.jpg" alt="harvard" width="668" height="110" />-c-c-c--c-c-c-<!--nextpage-->-c-c-c-<h2>オペレーティングシステム</h2>-c-c-c-<ul>-c-c-c- 	<li>ハードウェアの複雑さを隠すためのソフトウェア階層-c-c-c-<ul>-c-c-c- 	<li>ハードウェアをいじる人間には邪魔かもしれない</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>仕事-c-c-c-<ul>-c-c-c- 	<li> 抽象化-c-c-c-<ul>-c-c-c- 	<li>機械の世界から情報処理の世界へ</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>資源（リソース）管理-c-c-c-<ul>-c-c-c- 	<li>次々（同時）に来る「計算機（とその周辺機器）を-c-c-c-使いたいという要求」をいかに捌くか</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<h2>マイコン/OSでの抽象化</h2>-c-c-c-<ul>-c-c-c- 	<li>マイコン: メモリアドレスによる抽象化-c-c-c-<ul>-c-c-c- 	<li>様々な機器のデータ読み書き口を同じアドレス空間に配置（メモリマップドI/O）</li>-c-c-c- 	<li>ある番地の01を操作すると、ピンから電圧が出たり、入出力が逆転したり</li>-c-c-c- 	<li>メモリの番地を一つずつ書き換える操作</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>OS: <span style="color: #ffff00;">ファイルによる抽象化</span>-c-c-c-<ul>-c-c-c- 	<li>一連のデータを流し込んだり取り出したりできる（ストリーム）</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<h2> なんでもファイル</h2>-c-c-c-<ul>-c-c-c- 	<li>機器の操作（例: ラズパイマウスを例に）-c-c-c-<ul>-c-c-c- 	<li>/dev/rtmotor0等、ファイルの読み書きで操作</li>-c-c-c- 	<li>よくよく考えてみると、機器の操作というのはデータを-c-c-c-書いてデータ読むだけで済む</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<iframe src="https://www.youtube.com/embed/_SDwb_MJ4SA" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe>-c-c-c--c-c-c-<!--nextpage-->-c-c-c-<h2>こんなファイルも（擬似デバイス）</h2>-c-c-c-<ul>-c-c-c- 	<li>乱数発生器 /dev/random, /dev/urandom</li>-c-c-c- 	<li>ゴミ捨て場 /dev/null</li>-c-c-c- 	<li>ひたすら0x00を吐く /dev/zero</li>-c-c-c-</ul>-c-c-c-&nbsp;-c-c-c--c-c-c-&nbsp;
