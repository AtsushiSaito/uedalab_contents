<h2></h2>-c-c-c-<h1 style="font-size: 250%;">ロボットシステム学</h1>-c-c-c-<h2>第11回</h2>-c-c-c-上田 隆一-c-c-c--c-c-c-2016年12月21日\@千葉工業大学-c-c-c--c-c-c-<!--nextpage-->-c-c-c-<h2>ロボットと通信</h2>-c-c-c-<ul>-c-c-c- 	<li>自律分散系には必須ですね-c-c-c-<ul>-c-c-c- 	<li>そうですよね？</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>使いますよね-c-c-c-<ul>-c-c-c- 	<li>リモート監視・操作等</li>-c-c-c- 	<li>環境に埋め込んだセンサやアクチュエータの操作</li>-c-c-c- 	<li>ソフトウェアのインストール</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li><span style="color: #ff0000;">必須 </span></li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<h2>本日の内容</h2>-c-c-c-<ul>-c-c-c- 	<li>ネットワーク関係の設定方法を一通りおさえる</li>-c-c-c- 	<li>イーサネット・TCP/IP IP-c-c-c-<ul>-c-c-c- 	<li>アドレス・ポート</li>-c-c-c- 	<li>ソケット通信については前期やったそうなので割愛</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>ssh</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<h2>IPアドレスの体系</h2>-c-c-c-<ul>-c-c-c- 	<li>計算機の住所（ただし複数持つことができる）</li>-c-c-c- 	<li>IPアドレス: 0-255の数字を4つドットでつないで表記-c-c-c-<ul>-c-c-c- 	<li>例: 192.168.0.1</li>-c-c-c- 	<li>ローカルのものとグローバルのものが存在-c-c-c-<ul>-c-c-c- 	<li>グローバル-c-c-c-<ul>-c-c-c- 	<li>世界中でその計算機しか持っていない</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>ローカル（プライベートIPアドレス）-c-c-c-<ul>-c-c-c- 	<li>閉じた環境で使うアドレス</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<h2>ネットワーク部・ホスト部</h2>-c-c-c-<ul>-c-c-c- 	<li>IPアドレスを2進数で書いた時、左側の何桁かは「ネットワーク部」を表し、残りは「ホスト部」を表す</li>-c-c-c- 	<li>ネットワーク部-c-c-c-<ul>-c-c-c- 	<li>インターネットの中の一つのグループ</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>ホスト部-c-c-c-<ul>-c-c-c- 	<li>各PC固有の番号（住所で言うと番地）</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>サブネットマスク-c-c-c-<ul>-c-c-c- 	<li>どの部分がネットワーク部を表すかを示す数字</li>-c-c-c- 	<li>例: 255.255.255.0-c-c-c-<ul>-c-c-c- 	<li>2進数にすると11111111.11111111.11111111.00000000</li>-c-c-c- 	<li>ということで、左から24ビットがネットワーク部</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<ul>-c-c-c- 	<li>表記の例-c-c-c-<ul>-c-c-c- 	<li>192.168.1.2/255.255.255.0-c-c-c-<ul>-c-c-c- 	<li>192.168.1がネットワーク部で2がホスト部</li>-c-c-c- 	<li>192.168.1.2/24という書き方もある-c-c-c-<ul>-c-c-c- 	<li>左側24ビットがネットワーク部</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>コマンドで確かめてみましょう-c-c-c-<ul>-c-c-c- 	<li>-c-c-c-<pre><span style="color: #ffffff;">$ ip addr-c-c-c-...-c-c-c-<span class="s1">3: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000-c-c-c-</span><span class="s1">link/ether b8:27:eb:62:a8:84 brd ff:ff:ff:ff:ff:ff-c-c-c-</span><span class="s1">inet 192.168.0.4/24 brd 192.168.0.255 scope global eth0</span>-c-c-c-...-c-c-c-</span></pre>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<h2>ルーティング</h2>-c-c-c-<ul>-c-c-c- 	<li>別のネットワーク部にある計算機には無条件でアクセスできない-c-c-c-<ul>-c-c-c- 	<li>別のネットワークにパケットを出す設定が必要-c-c-c-<ul>-c-c-c- 	<li>計算機で設定しなければならないこと</li>-c-c-c- 	<li>外にパケットを出すときにどのルータに向けてパケットを送るか</li>-c-c-c- 	<li>どのIPアドレスが外のものなのか</li>-c-c-c- 	<li>（DHCPを使っていると自動で設定されているので気がつかない）</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li><span style="color: #ff0000;">ルータがネットワークの境界にいて交通整理</span>-c-c-c-<ul>-c-c-c- 	<li>「ルーティング」</li>-c-c-c- 	<li>tracerouteを打ってみましょう（次ページ）</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<pre><span style="color: #ffffff;">$ traceroute 8.8.8.8</span>-c-c-c-<span style="color: #ffffff;">traceroute to 8.8.8.8 (8.8.8.8), 30 hops max, 60 byte packets</span>-c-c-c-<span style="color: #ffffff;">1  133.242.186.1 (133.242.186.1)  1.073 ms  1.062 ms  1.047 ms</span>-c-c-c-<span style="color: #ffffff;">2  iskrt102b-rt109e.bb.sakura.ad.jp (103.10.114.73)  1.003 ms iskrt101b-rt109e.bb.sakura.ad.jp (103.10.114.65)  1.013 ms iskrt102b-rt109e.bb.sakura.ad.jp (103.10.114.73)  1.010 ms</span>-c-c-c-<span style="color: #ffffff;">3  iskrt1s-rt101b-2.bb.sakura.ad.jp (103.10.113.93)  0.976 ms iskrt2s-rt102b-2.bb.sakura.ad.jp (103.10.113.105)  0.974 ms iskrt1s-rt101b-1.bb.sakura.ad.jp (103.10.113.9)  0.956 ms</span>-c-c-c-<span style="color: #ffffff;">4  iskrt3-rt2s.bb.sakura.ad.jp (103.10.113.113)  2.061 ms iskrt3-rt1s.bb.sakura.ad.jp (103.10.113.109)  2.050 ms iskrt4-rt2s.bb.sakura.ad.jp (103.10.113.121)  0.892 ms</span>-c-c-c-<span style="color: #ffffff;">5  tkort3-iskrt3.bb.sakura.ad.jp (157.17.131.33)  16.704 ms tkert1-iskrt4.bb.sakura.ad.jp (157.17.131.37)  20.049 ms tkort3-iskrt3.bb.sakura.ad.jp (157.17.131.33)  16.672 ms</span>-c-c-c-<span style="color: #ffffff;">6  as15169.ix.jpix.ad.jp (210.171.224.96)  20.114 ms  19.862 ms tkort3-ert1.bb.sakura.ad.jp (157.17.130.113)  18.166 ms</span>-c-c-c-<span style="color: #ffffff;">7  as15169.ix.jpix.ad.jp (210.171.224.96)  21.424 ms 108.170.242.161 (108.170.242.161)  20.457 ms as15169.ix.jpix.ad.jp (210.171.224.96)  21.547 ms</span>-c-c-c-<span style="color: #ffffff;">8  209.85.255.141 (209.85.255.141)  21.071 ms 108.170.242.193 (108.170.242.193)  22.333 ms 72.14.239.193 (72.14.239.193)  21.048 ms</span>-c-c-c-<span style="color: #ffffff;">9  72.14.238.173 (72.14.238.173)  22.553 ms 72.14.239.31 (72.14.239.31)  19.628 ms google-public-dns-a.google.com (8.8.8.8)  17.074 ms</span></pre>-c-c-c-<!--nextpage-->-c-c-c-<ul>-c-c-c- 	<li>ルーティング情報の閲覧・設定-c-c-c-<ul>-c-c-c- 	<li> route(8)を使います</li>-c-c-c- 	<li>下の例の読み方-c-c-c-<ul>-c-c-c- 	<li>255.255.254.0でマスクをかけた時のIPアドレスが一致すれば直接データを相手のIPアドレスに送る</li>-c-c-c- 	<li>それ以外の場合は「デフォルトゲートウェイ」-c-c-c-<p class="p1"><span class="s1">133.242.186.1に送る</span></p>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<pre class="p1"><span style="color: #ffffff;"><span class="s1">ueda\@remote</span><span class="s2">:</span><span class="s3">~</span><span class="s2">$ route-c-c-c-</span><span class="s1">カーネルIP経路テーブル-c-c-c-</span><span class="s1">受信先サイト<span class="Apple-converted-space">    </span>ゲートウェイ<span class="Apple-converted-space">    </span>ネットマスク <span class="Apple-converted-space">  </span>フラグ Metric Ref 使用数 インタフェース-c-c-c-</span><span class="s1">default <span class="Apple-converted-space">        </span>133.242.186.1 <span class="Apple-converted-space">  </span>0.0.0.0 <span class="Apple-converted-space">        </span>UG<span class="Apple-converted-space">    </span>0<span class="Apple-converted-space">      </span>0<span class="Apple-converted-space">        </span>0 eth0-c-c-c-</span><span class="s1">localnet<span class="Apple-converted-space">        </span>* <span class="Apple-converted-space">              </span>255.255.254.0 <span class="Apple-converted-space">  </span>U <span class="Apple-converted-space">    </span>0<span class="Apple-converted-space">      </span>0<span class="Apple-converted-space">        </span>0 eth0</span></span></pre>-c-c-c-<!--nextpage-->-c-c-c-<h2>IPアドレスの設定</h2>-c-c-c-<ul>-c-c-c- 	<li>有線（Raspberry Piの場合）-c-c-c-<ul>-c-c-c- 	<li>最初からDHCPに設定されている</li>-c-c-c- 	<li>通常はこのままDHCPで良い-c-c-c-<ul>-c-c-c- 	<li>固定すると別の環境でログインできなくなる等、難しくなる</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>IPアドレスはルータのウェブページ、nmap等で確認可能-c-c-c-<ul>-c-c-c- 	<li>-c-c-c-<pre><span style="color: #ffffff;">$ nmap -sP 192.168.2.0/24</span></pre>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c- 	<li>DHCPでもルータ等で固定できる</li>-c-c-c-</ul>-c-c-c-<!--nextpage-->-c-c-c-<h2>固定IPの設定</h2>-c-c-c-<ul>-c-c-c- 	<li>/etc/network/interfacesに設定を書く-c-c-c-<ul>-c-c-c- 	<li>下図: デフォルトの設定例（バージョンによって異なる）</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>-c-c-c-<pre><span style="color: #ffffff;">pi\@raspberrypi ~ $ cat /etc/network/interfaces</span>-c-c-c-<span style="color: #ffffff;">auto lo</span>-c-c-c-<span style="color: #ffffff;">iface lo inet loopback</span>-c-c-c--c-c-c-<span style="color: #ffffff;">iface eth0 inet dhcp </span></pre>-c-c-c-<!--nextpage-->-c-c-c-<ul>-c-c-c- 	<li>固定にする例</li>-c-c-c- 	<li>-c-c-c-<pre><span style="color: #ffffff;">pi\@raspberrypi ~ $ cat /etc/network/interfaces</span>-c-c-c-<span style="color: #ffffff;">auto lo</span>-c-c-c--c-c-c-<span style="color: #ffffff;">iface lo inet loopback</span>-c-c-c-<span style="color: #ffffff;">#iface eth0 inet dhcp</span>-c-c-c-<span style="color: #ffffff;">auto eth0</span>-c-c-c-<span style="color: #ffffff;">iface eth0 inet static</span>-c-c-c-<span style="color: #ffffff;">address 192.168.1.200</span>-c-c-c-<span style="color: #ffffff;">netmask 255.255.255.0</span>-c-c-c-<span style="color: #ffffff;">gateway 192.168.1.1</span></pre>-c-c-c-<ul>-c-c-c- 	<li>dhcpの設定は#でコメントアウトを</li>-c-c-c- 	<li>設定後はrebootするのが素直</li>-c-c-c- 	<li>したくない時は</li>-c-c-c- 	<li>-c-c-c-<pre><span style="color: #ffffff;">$ sudo service networking restart</span></pre>-c-c-c-</li>-c-c-c-</ul>-c-c-c-</li>-c-c-c-</ul>
